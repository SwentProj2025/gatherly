package com.android.gatherly.utils

import kotlinx.coroutines.flow.MutableStateFlow

// This file contains code generated by an LLM (Claude.ai).

/**
 * A utility class to coordinate map centering requests based on event IDs. It allows requesting the
 * map to center on a specific event and tracks whether the request has been consumed.
 */
class MapCoordinator {
  /**
   * Data class representing a centering request for a specific event.
   *
   * @property eventId The ID of the event to center on.
   * @property todoId The ID of the todo to center on.
   * @property consumed A flag indicating whether the request has been consumed.
   */
  private data class CenterRequest(
      val eventId: String? = null,
      val todoId: String? = null,
      val consumed: Boolean = false
  )

  /**
   * StateFlow holding the current centering request. It is private to prevent external
   * modification.
   */
  private val _pendingRequest = MutableStateFlow<CenterRequest?>(null)

  /**
   * Requests the map to center on the specified event ID.
   *
   * @param eventId The ID of the event to center on.
   */
  fun requestCenterOnEvent(eventId: String) {
    _pendingRequest.value = CenterRequest(eventId, consumed = false)
  }

  /**
   * Requests the map to center on the specified todo ID.
   *
   * @param todoId The ID of the todo to center on.
   */
  fun requestCenterOnTodo(todoId: String) {
    _pendingRequest.value = CenterRequest(todoId = todoId, consumed = false)
  }
  /**
   * Retrieves the event ID of the unconsumed centering request, if any.
   *
   * @return The event ID if there is an unconsumed request; otherwise, null.
   */
  fun getUnconsumedEventId(): String? {
    return _pendingRequest.value?.let { if (!it.consumed) it.eventId else null }
  }

  /**
   * Retrieves the todo ID of the unconsumed centering request, if any.
   *
   * @return The todo ID if there is an unconsumed request; otherwise, null.
   */
  fun getUnconsumedTodoId(): String? =
      _pendingRequest.value?.let { if (!it.consumed) it.todoId else null }

  /** Marks the current centering request as consumed. */
  fun markConsumed() {
    _pendingRequest.value?.let { _pendingRequest.value = it.copy(consumed = true) }
  }
}
