package com.android.gatherly.model.notification

// This file contains code generated by an LLM (Claude.ai, GitHub Copilot).

/** Local in-memory implementation of [NotificationsRepository] for managing notifications. */
open class NotificationsLocalRepository() : NotificationsRepository {

  /** ID counter for generating unique notification IDs. */
  private var counter = 0

  /** In-memory storage for notifications, mapping notification IDs to Notification objects. */
  private val notifications: MutableMap<String, Notification> = mutableMapOf()

  override fun getNewId(): String {
    return counter++.toString()
  }

  override suspend fun getUserNotifications(userId: String): List<Notification> {
    return notifications.values
        .filter { it.recipientId == userId }
        .sortedBy { it.emissionTime }
  }

  override suspend fun getNotification(notificationId: String): Notification {
    return notifications[notificationId]
        ?: throw NoSuchElementException("Notification with ID $notificationId not found")
  }

  override suspend fun deleteNotification(notificationId: String) {
    if (notifications.remove(notificationId) == null) {
      throw NoSuchElementException("Notification with ID $notificationId not found")
    }
  }

  override suspend fun addNotification(notification: Notification) {
    require(!notifications.containsKey(notification.id)) {
      "Notification with ID ${notification.id} already exists"
    }
    notifications[notification.id] = notification
  }

  override suspend fun markAsRead(notificationId: String) {
    val notification = getNotification(notificationId)
    notifications[notificationId] = notification.copy(wasRead = true)
  }
}
